
//: Declare String Begin

/*: "msgType" :*/
fileprivate let constReasonGivenMsg:String = "msgTylick session fault access exercise"
fileprivate let dataNorthFormat:String = "perror"

/*: "tips" :*/
fileprivate let app_sitStr:String = "tproperlys"

/*: "extra" :*/
fileprivate let appDominantText:String = "eprovincera"

/*: "msgInfo" :*/
fileprivate let dataColumnId:String = "mcome"
fileprivate let constTitleureData:[Character] = ["g","I","n","f","o"]

/*: "user" :*/
fileprivate let appDevilStr:String = "usequantity"

/*: "uid" :*/
fileprivate let const_animaId:String = "uweatherd"

/*: "nickname" :*/
fileprivate let show_providePath:[UInt8] = [0x26,0x21,0x1b,0x23,0x26,0x19,0x25,0x1d]

fileprivate func penobscotRiver(design num: UInt8) -> UInt8 {
    let value = Int(num) - 184
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "headPic" :*/
fileprivate let constEarnData:[UInt8] = [0x7c,0x79,0x75,0x78,0x64,0x7d,0x77]

fileprivate func minimumPriority(genre num: UInt8) -> UInt8 {
    let value = Int(num) - 20
    if value < 0 {
        return UInt8(value + 256)
    } else {
        return UInt8(value)
    }
}

/*: "age" :*/
fileprivate let data_disagreeWhoFormat:[UInt8] = [0x4,0x2,0x0]

/*: "gift" :*/
fileprivate let k_finishKey:String = "gaccuracyft"

/*: "isGroup" :*/
fileprivate let data_raftPath:[Character] = ["i","s","G","r","o","u","p"]

/*: "WantGift" :*/
fileprivate let k_unablePath:[Character] = ["W","a","n","t","G","i"]
fileprivate let noti_sizeText:String = "frankt"

/*: "txt" :*/
fileprivate let notiBoyTitle:[Character] = ["t","x","t"]

/*: "img" :*/
fileprivate let dataFirstKey:[Character] = ["i","m","g"]

/*: "video" :*/
fileprivate let constEquityPlatName:[Character] = ["v","i","d","e","o"]

/*: "audio" :*/
fileprivate let constOccurTitle:String = "AUDIO"

/*: "messageType" :*/
fileprivate let mainDemonstrateMessage:[Character] = ["m","e","s","s","a"]
fileprivate let showAudienceLengthEqualMsg:String = "geTypeload sibling dog"

/*: "contentType" :*/
fileprivate let app_descriptionUrl:[Character] = ["c","o","n","t","e","n","t","T","y","p","e"]

/*: "ImgMsg" :*/
fileprivate let show_limitSenseName:[Character] = ["I","m","g","M","s","g"]

/*: "imageUri" :*/
fileprivate let main_stemId:[Character] = ["i","m","a","g","e"]
fileprivate let user_topicKey:[Character] = ["U","r","i"]

/*: "type" :*/
fileprivate let showDivisionMessage:String = "tdisablee"

/*: "pic" :*/
fileprivate let k_additionalUrl:String = "pibefore"

/*: "isBurn" :*/
fileprivate let noti_diskPath:String = "isBurnstereo uniform rid"

/*: "giftId" :*/
fileprivate let noti_runData:[Character] = ["g","i","f","t","I"]
fileprivate let appPresentPath:String = "box"

/*: "params" :*/
fileprivate let k_mmConvertFollowingId:String = "pparentrparentm"
fileprivate let notiPermissionDueSpyMsg:[Character] = ["s"]

/*: "audioLength" :*/
fileprivate let constSmallData:[Character] = ["a","u","d","i","o","L","e","n"]
fileprivate let app_thenText:[Character] = ["g","t","h"]

/*: "len" :*/
fileprivate let noti_inputUrl:[Character] = ["l","e","n"]

/*: "audioSandbox" :*/
fileprivate let notiHockeyTitle:String = "existing appearaudioS"

/*: "senderId" :*/
fileprivate let showFormatMessage:[Character] = ["s","e","n","d","e","r","I","d"]

/*: "AudioMsg" :*/
fileprivate let appFatalData:String = "demonstrate automaticallyAudioMs"
fileprivate let app_requestId:String = "living"

/*: "content" :*/
fileprivate let mainFirstText:[Character] = ["c","o","n","t","e","n"]
fileprivate let k_absInformSpherePath:String = "successful"

/*: "TxtMsg" :*/
fileprivate let main_discoverFormat:String = "pending equity process leaseTxtMs"
fileprivate let main_oneData:String = "track"

/*: "message" :*/
fileprivate let k_driveMessage:[Character] = ["m","e","s","s","a","g","e"]

/*: "quoteMsgId" :*/
fileprivate let const_quantityKey:[Character] = ["q","u","o","t","e","M"]
fileprivate let app_combinedTitle:[Character] = ["s","g","I","d"]

/*: "quoteMsgInfo" :*/
fileprivate let main_conKey:[Character] = ["q","u","o","t","e","M","s","g","I","n","f","o"]

/*: "rYMsgType" :*/
fileprivate let dataThemeId:String = "identity shallrYMs"
fileprivate let constPlusStr:[Character] = ["g","T","y","p","e"]

/*: "GJ:Sess:AutoGreet:TxtCustom" :*/
fileprivate let const_processingKey:String = "GJ:Sessenterprise particle let hung prompt"
fileprivate let notiComputerName:String = ":"
fileprivate let showFlagExecuteMessage:[Character] = ["A","u","t","o","G","r","e","e","t",":","T","x","t","C","u","s","t","o","m"]

/*: "changeDirection" :*/
fileprivate let show_appropriateTitle:[Character] = ["c"]
fileprivate let main_editorMessage:String = "dark reference middle dismisshangeD"
fileprivate let data_windowFormat:String = "tiocombined"

/*: "system" :*/
fileprivate let appMaxName:[Character] = ["s","y","s","t","e","m"]

/*: "title" :*/
fileprivate let app_leadingId:String = "trequirele"

/*: "icon" :*/
fileprivate let appClipAirHeartStr:String = "iincidentn"

/*: "all" :*/
fileprivate let noti_halfId:[Character] = ["a","l","l"]

/*: "icon_chats_pcr" :*/
fileprivate let data_fastUrl:[Character] = ["i","c","o","n","_","c","h","a","t","s","_","p","c","r"]

/*: "status" :*/
fileprivate let mainSubjectEffText:String = "spartapartus"

/*: "msgIncome" :*/
fileprivate let noti_layerMessage:[Character] = ["m","s","g","I","n","c","o","m","e"]

/*: "msgId" :*/
fileprivate let show_speakerPath:String = "msgIdrest now"

/*: "ProposalColumnConvertible" :*/
fileprivate let showScoreValue:[Character] = ["T","M","s","g","T","r","a","n","s","l","a","t","e","S","t"]
fileprivate let data_coordinatorUrl:String = "ATUS"

/*: "TMsgTranslatedContent" :*/
fileprivate let user_capableMinProvideName:[Character] = ["T","M","s","g","T","r","a","n","s","l","a","t","e","d","C","o"]
fileprivate let userSlimStr:String = "somebodyesomebody"

/*: "formatType" :*/
fileprivate let main_smallMessage:String = "forpreserve"
fileprivate let constAutomaticText:[Character] = ["e"]

/*: "plain" :*/
fileprivate let app_truthId:String = "narrowlain"

/*: "imageData" :*/
fileprivate let showSoundPastPath:String = "imearge"

/*: "VideoMsg" :*/
fileprivate let kDiscoverMsg:String = "spread"
fileprivate let appFailureUrl:[Character] = ["i","d","e","o","M","s","g"]

/*: "match" :*/
fileprivate let kMatchMessage:String = "MATCH"

/*: "userIntro" :*/
fileprivate let data_drownName:[Character] = ["u","s","e","r","I","n","t","r","o"]

/*: "targetId" :*/
fileprivate let showUponText:String = "spec distancetargetI"
fileprivate let user_sufficientFormat:String = "dimension"

/*: "yyyy-MM-dd HH:mm:ss" :*/
fileprivate let main_giftName:String = "yyyy-Mfood every yesterday able enterprise"
fileprivate let user_captureValue:String = "count random pow yourself placeHH:mm:s"
fileprivate let appBottomText:String = "square"

/*: "sendTime" :*/
fileprivate let notiDisappearPath:[Character] = ["s","e","n","d","T","i","m","e"]

/*: "isRead" :*/
fileprivate let mainLibraryCapPath:String = "I"
fileprivate let k_platformData:String = "margin shape previous magnitudesRead"

/*: "audioData" :*/
fileprivate let user_ceremonyPath:[Character] = ["a","u","d","i","o","D","a","t","a"]

/*: "audioUri" :*/
fileprivate let notiDecisionStr:[Character] = ["a","u","d","i","o","U","r","i"]

//: Declare String End

// __DEBUG__
// __CLOSE_PRINT__
//
//  ManagerThen.swift

//: import Foundation
import Foundation

// MARK: - 枚举定义

//: @objc public enum TXMessageContentType: UInt {
@objc public enum SortEquatable: UInt {
    //: case TXMessageContentType_text = 1
    case TXMessageContentType_text = 1
    //: case TXMessageContentType_picture
    case TXMessageContentType_picture
    //: case TXMessageContentType_gift
    case TXMessageContentType_gift
    //: case TXMessageContentType_askforGift
    case TXMessageContentType_askforGift
    //: case TXMessageContentType_voice
    case TXMessageContentType_voice
    //: case TXMessageContentType_local
    case TXMessageContentType_local
    //: case TXMessageContentType_tips
    case TXMessageContentType_tips
    //: case TXMessageContentType_userCard
    case TXMessageContentType_userCard
    //: case TXMessageContentType_video
    case TXMessageContentType_video
}

// MARK: - ManagerThen

//: @objcMembers public class TUISocialChatManager: NSObject {
@objcMembers public class ManagerThen: NSObject {
    // MARK: - 公共方法

    /// 获取消息插入的时间戳 毫秒
    //: public class func getMessageInsertTime() -> Int64 {
    public class func earlyPan() -> Int64 {
        //: let curDate = Date().timeIntervalSince1970
        let curDate = Date().timeIntervalSince1970
        //: let msInterval = Int64(floor(curDate * 1000))
        let msInterval = Int64(floor(curDate * 1000))
        //: var deltaTime = Int64(V2TIMManager.sharedInstance().getServerTime())
        var deltaTime = Int64(V2TIMManager.sharedInstance().getServerTime()) // 秒为单位
        //: if deltaTime < 1 {
        if deltaTime < 1 {
            //: deltaTime = 0
            deltaTime = 0
        }
        //: let timeStamp = msInterval - deltaTime
        let timeStamp = msInterval - deltaTime
        //: return timeStamp
        return timeStamp
    }

    // MARK: - 腾讯IM消息处理

    /// 腾讯IM消息插入
    //: public class func insertTXMessage(withExtral extral: [String: Any], toUid: String, isSender: Bool, isTip: Bool) -> TwoCellData? {
    public class func beforeTingTip(withExtral extral: [String: Any], toUid: String, isSender: Bool, isTip: Bool) -> TwoCellData? {
        //: let data = handleTXMessageSend(withExtral: extral, isSender: isSender, isTip: isTip)
        let data = coordinate(withExtral: extral, isSender: isSender, isTip: isTip)
        //: if let data = data {
        if let data = data {
            //: LightConversationListener.shared.func__handleMsg(targetId: toUid, msgCellData: data, isPrivete: true)
            LightConversationListener.shared.purePrivete(targetId: toUid, msgCellData: data, isPrivete: true)
        }
        //: return data
        return data
    }

    /// 腾讯IM发送消息组装
    //: public class func handleTXMessageSend(withExtral extral: [String: Any], isSender: Bool, isTip: Bool) -> TwoCellData? {
    public class func coordinate(withExtral extral: [String: Any], isSender: Bool, isTip: Bool) -> TwoCellData? {
        //: if isTip {
        if isTip {
            //: var extralDict = extral
            var extralDict = extral
            //: extralDict["msgType"] = "tips"
            extralDict[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] = (app_sitStr.replacingOccurrences(of: "properly", with: "ip"))
            //: let extraDict = ["extra": extralDict]
            let extraDict = [(appDominantText.replacingOccurrences(of: "province", with: "xt")): extralDict]
            //: let extra = parseTXMessageJsonStr(data: extraDict)
            let extra = yesterday(data: extraDict)
            //: let data = TalkingChatTipsMsgCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = PreviouslyFactorCompartmentTipsInformationCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extra.data(using: .utf8)
            let cData = extra.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: data.innerMessage.isExcludedFromLastMessage = true
            data.innerMessage.isExcludedFromLastMessage = true
            //: let model = AbTalkingChatMsgBaseModel()
            let model = SpotModel()
            //: if let tipModel = try? AbTalkingChatMsgTipsModel(dictionary: extralDict) {
            if let tipModel = try? StereoDogModel(dictionary: extralDict) {
                //: model.tips = tipModel
                model.tips = tipModel
            }
            //: data.msgModel = model
            data.msgModel = model
            //: return data
            return data
        }

        //: var tempDict = extral
        var tempDict = extral
        //: guard let msgInfo = extral["msgInfo"] as? [String: Any] else {
        guard let msgInfo = extral[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] as? [String: Any] else {
            //: return nil
            return nil
        }

        //: tempDict["user"] = [
        tempDict[(appDevilStr.replacingOccurrences(of: "quantity", with: "r"))] = [
            //: "uid": CompositionReactiveCompatible.share.loginUserMode.userID,
            (const_animaId.replacingOccurrences(of: "weather", with: "i")): CompositionReactiveCompatible.share.loginUserMode.userID,
            //: "nickname": CompositionReactiveCompatible.share.loginUserMode.nickname,
            String(bytes: show_providePath.map{penobscotRiver(design: $0)}, encoding: .utf8)!: CompositionReactiveCompatible.share.loginUserMode.nickname,
            //: "headPic": CompositionReactiveCompatible.share.loginUserMode.headPic,
            String(bytes: constEarnData.map{minimumPriority(genre: $0)}, encoding: .utf8)!: CompositionReactiveCompatible.share.loginUserMode.headPic,
            //: "age": CompositionReactiveCompatible.share.loginUserMode.age,
            String(bytes: data_disagreeWhoFormat.map{$0^101}, encoding: .utf8)!: CompositionReactiveCompatible.share.loginUserMode.age,
        ]

        //: let extraDict = ["extra": tempDict]
        let extraDict = [(appDominantText.replacingOccurrences(of: "province", with: "xt")): tempDict]
        //: let extraString = parseTXMessageJsonStr(data: extraDict)
        let extraString = yesterday(data: extraDict)

        // 礼物
        //: if msgInfo["msgType"] as? String == "gift" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (k_finishKey.replacingOccurrences(of: "accuracy", with: "i")) {
            //: var data: TwoCellData
            var data: TwoCellData
            //: if msgInfo["isGroup"] as? String == "1" {  // 群聊
            if msgInfo[(String(data_raftPath))] as? String == "1" { // 群聊
                //: data = TalkingGroupChatGiftMsgCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                data = MaximumThen(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                //: } else {
            } else {
                //: data = OpenceMoreCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                data = OpenceMoreCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            }

            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 索要礼物
        //: if msgInfo["msgType"] as? String == "WantGift" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(k_unablePath) + noti_sizeText.replacingOccurrences(of: "frank", with: "f")) {
            //: let data = FactorSelectedCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = FactorSelectedCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 文字
        //: if msgInfo["msgType"] as? String == "txt" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(notiBoyTitle)) {
            //: var data: TwoCellData
            var data: TwoCellData
            //: if msgInfo["isGroup"] as? String == "1" {  // 群聊
            if msgInfo[(String(data_raftPath))] as? String == "1" { // 群聊
                //: data = BrowseThen(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                data = BrowseThen(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                //: } else {
            } else {
                //: data = SortCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                data = SortCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            }
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 图片
        //: if msgInfo["msgType"] as? String == "img" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(dataFirstKey)) {
            //: let data = MilitaryCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = MilitaryCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 视频
        //: if msgInfo["msgType"] as? String == "video" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(constEquityPlatName)) {
            //: let data = MovieReactiveCompatible(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = MovieReactiveCompatible(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 语音
        //: if msgInfo["msgType"] as? String == "audio" {
        if msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (constOccurTitle.lowercased()) {
            //: let data = MidReactiveCompatible(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = MidReactiveCompatible(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        // 打招呼
        //: if extral["gift"] != nil && (msgInfo["messageType"] as? Int) == 4 {
        if extral[(k_finishKey.replacingOccurrences(of: "accuracy", with: "i"))] != nil && (msgInfo[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int) == 4 {
            //: let data = SortCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            let data = SortCellData(direction: isSender ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: let cData = extraString.data(using: .utf8)
            let cData = extraString.data(using: .utf8)
            //: data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            data.innerMessage = V2TIMManager.sharedInstance().createCustomMessage(cData)
            //: if let model = try? AbTalkingChatMsgBaseModel(dictionary: tempDict) {
            if let model = try? SpotModel(dictionary: tempDict) {
                //: data.msgModel = model
                data.msgModel = model
            }
            //: return data
            return data
        }

        //: return nil
        return nil
    }

    /// 腾讯IM重发消息组装 （只有私聊在用）
    //: public class func handleTXMessageReSend(withData cellData: TwoCellData) -> TwoCellData? {
    public class func less(withData cellData: TwoCellData) -> TwoCellData? {
        // 图片
        //: if let reCellData = cellData as? MilitaryCellData {
        if let reCellData = cellData as? MilitaryCellData {
            //: let paths = NSSearchPathForDirectoriesInDomains(.cachesDirectory, .userDomainMask, true)
            let paths = NSSearchPathForDirectoriesInDomains(.cachesDirectory, .userDomainMask, true)
            //: var filePath = paths.first!
            var filePath = paths.first!
            //: filePath = (filePath as NSString).appendingPathComponent(DirtyMacroDefine.getImageFileName())
            filePath = (filePath as NSString).appendingPathComponent(DirtyMacroDefine.trademark())
            //: filePath = (filePath as NSString).appendingPathComponent((reCellData.imageUrl! as NSString).lastPathComponent)
            filePath = (filePath as NSString).appendingPathComponent((reCellData.imageUrl! as NSString).lastPathComponent)

            //: if !FileManager.default.fileExists(atPath: filePath) {
            if !FileManager.default.fileExists(atPath: filePath) {
                //: return nil
                return nil
            }

            //: var dic: [String: Any] = [:]
            var dic: [String: Any] = [:]
            //: var params: [String: Any] = [:]
            var params: [String: Any] = [:]
            //: var msgInfo: [String: Any] = [:]
            var msgInfo: [String: Any] = [:]
            //: msgInfo["contentType"] = "ImgMsg"
            msgInfo[(String(app_descriptionUrl))] = (String(show_limitSenseName))
            //: msgInfo["msgType"] = "img"
            msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] = (String(dataFirstKey))
            //: msgInfo["imageUri"] = filePath
            msgInfo[(String(main_stemId) + String(user_topicKey))] = filePath
            //: dic["msgInfo"] = msgInfo
            dic[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] = msgInfo

            //: params["type"] = "ImgMsg"
            params[(showDivisionMessage.replacingOccurrences(of: "disable", with: "yp"))] = (String(show_limitSenseName))
            //: params["pic"] = filePath
            params[(k_additionalUrl.replacingOccurrences(of: "before", with: "c"))] = filePath

            // 重发私密照片
            //: let isBurn = reCellData.msgModel.msgInfo.customSend.isBurn
            let isBurn = reCellData.msgModel.msgInfo.customSend.isBurn
            //: if !isBurn.isEmpty {
            if !isBurn.isEmpty {
                //: params["isBurn"] = isBurn
                params[(String(noti_diskPath.prefix(6)))] = isBurn
                //: } else {
            } else {
                //: params["isBurn"] = "0"
                params[(String(noti_diskPath.prefix(6)))] = "0"
            }

            //: let giftId = reCellData.msgModel.msgInfo.customSend.giftId
            let giftId = reCellData.msgModel.msgInfo.customSend.giftId
            //: if !giftId.isEmpty {
            if !giftId.isEmpty {
                //: params["giftId"] = giftId
                params[(String(noti_runData) + appPresentPath.replacingOccurrences(of: "box", with: "d"))] = giftId
                //: } else {
            } else {
                //: params["giftId"] = "0"
                params[(String(noti_runData) + appPresentPath.replacingOccurrences(of: "box", with: "d"))] = "0"
            }

            //: dic["params"] = params
            dic[(k_mmConvertFollowingId.replacingOccurrences(of: "parent", with: "a") + String(notiPermissionDueSpyMsg))] = params

            //: let data = handleTXMessageSend(withExtral: dic, isSender: true, isTip: false)
            let data = coordinate(withExtral: dic, isSender: true, isTip: false)
            //: data?.status = .Msg_Status_Fail
            data?.status = .Msg_Status_Fail
            //: return data
            return data
        }

        // 视频
        //: if let reCellData = cellData as? MovieReactiveCompatible {
        if let reCellData = cellData as? MovieReactiveCompatible {
            //: reCellData.status = .Msg_Status_Fail
            reCellData.status = .Msg_Status_Fail
            //: return reCellData
            return reCellData
        }

        // 语音
        //: if let reCellData = cellData as? MidReactiveCompatible {
        if let reCellData = cellData as? MidReactiveCompatible {
            //: let voiceModel = DBUserInfoManager.cache_getAudioDB(message: reCellData.innerMessage)
            let voiceModel = OverAgainInfoManager.clubMessage(message: reCellData.innerMessage)
            //: var dic: [String: Any] = [:]
            var dic: [String: Any] = [:]
            //: var msgInfo: [String: Any] = [:]
            var msgInfo: [String: Any] = [:]
            //: var params: [String: Any] = [:]
            var params: [String: Any] = [:]

            //: if !voiceModel.db_audioLength.isEmpty {
            if !voiceModel.db_audioLength.isEmpty {
                //: msgInfo["audioLength"] = voiceModel.db_audioLength
                msgInfo[(String(constSmallData) + String(app_thenText))] = voiceModel.db_audioLength
                //: params["len"] = voiceModel.db_audioLength
                params[(String(noti_inputUrl))] = voiceModel.db_audioLength
            }
            //: if !voiceModel.db_filePath.isEmpty {
            if !voiceModel.db_filePath.isEmpty {
                //: msgInfo["audioSandbox"] = voiceModel.db_filePath
                msgInfo[(String(notiHockeyTitle.suffix(6)) + "andbox")] = voiceModel.db_filePath
                //: params["audioSandbox"] = voiceModel.db_filePath
                params[(String(notiHockeyTitle.suffix(6)) + "andbox")] = voiceModel.db_filePath
            }
            //: msgInfo["msgType"] = "audio"
            msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] = (constOccurTitle.lowercased())
            //: msgInfo["senderId"] = CompositionReactiveCompatible.share.loginUserMode.userID
            msgInfo[(String(showFormatMessage))] = CompositionReactiveCompatible.share.loginUserMode.userID
            //: dic["msgInfo"] = msgInfo
            dic[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] = msgInfo

            //: params["type"] = "AudioMsg"
            params[(showDivisionMessage.replacingOccurrences(of: "disable", with: "yp"))] = (String(appFatalData.suffix(7)) + app_requestId.replacingOccurrences(of: "living", with: "g"))
            //: dic["params"] = params
            dic[(k_mmConvertFollowingId.replacingOccurrences(of: "parent", with: "a") + String(notiPermissionDueSpyMsg))] = params

            //: let data = handleTXMessageSend(withExtral: dic, isSender: true, isTip: false)
            let data = coordinate(withExtral: dic, isSender: true, isTip: false)
            //: data?.status = .Msg_Status_Fail
            data?.status = .Msg_Status_Fail
            //: return data
            return data
        }

        // 文本
        //: if let reCellData = cellData as? SortCellData {
        if let reCellData = cellData as? SortCellData {
            //: var dic: [String: Any] = [:]
            var dic: [String: Any] = [:]
            //: var params: [String: Any] = [:]
            var params: [String: Any] = [:]
            //: var msgInfo: [String: Any] = [:]
            var msgInfo: [String: Any] = [:]

            //: msgInfo["content"] = reCellData.contentStr ?? ""
            msgInfo[(String(mainFirstText) + k_absInformSpherePath.replacingOccurrences(of: "successful", with: "t"))] = reCellData.contentStr ?? ""
            //: msgInfo["msgType"] = "txt"
            msgInfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] = (String(notiBoyTitle))
            //: dic["msgInfo"] = msgInfo
            dic[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] = msgInfo
            //: params["type"] = "TxtMsg"
            params[(showDivisionMessage.replacingOccurrences(of: "disable", with: "yp"))] = (String(main_discoverFormat.suffix(5)) + main_oneData.replacingOccurrences(of: "track", with: "g"))
            //: params["message"] = reCellData.contentStr ?? ""
            params[(String(k_driveMessage))] = reCellData.contentStr ?? ""

            //: if reCellData.msgModel.quoteMsgInfo.isQuoteMsg() == true {
            if reCellData.msgModel.quoteMsgInfo.iconography() == true { // 引用消息重发
                //: params["quoteMsgId"] = reCellData.msgModel.quoteMsgInfo.msgId
                params[(String(const_quantityKey) + String(app_combinedTitle))] = reCellData.msgModel.quoteMsgInfo.msgId
                //: dic["quoteMsgInfo"] = reCellData.msgModel.quoteMsgInfo
                dic[(String(main_conKey))] = reCellData.msgModel.quoteMsgInfo
                    //: .toDictionary()
                    .toDictionary()
            }

            //: dic["params"] = params
            dic[(k_mmConvertFollowingId.replacingOccurrences(of: "parent", with: "a") + String(notiPermissionDueSpyMsg))] = params

            //: let data = handleTXMessageSend(withExtral: dic, isSender: true, isTip: false)
            let data = coordinate(withExtral: dic, isSender: true, isTip: false)
            //: data?.status = .Msg_Status_Fail
            data?.status = .Msg_Status_Fail
            //: return data
            return data
        }

        //: return nil
        return nil
    }

    /// 腾讯IM接收消息组装
    //: public class func handleTXReceiveMessage(withExtral dic: [String: Any], cusData: Data, tempModel: V2TIMMessage) -> TwoCellData? {
    public class func managerModel(withExtral dic: [String: Any], cusData: Data, tempModel: V2TIMMessage) -> TwoCellData? {
        //: var cellData: TwoCellData?
        var cellData: TwoCellData?
        //: let extraDict = dic["extra"] as? [String: Any]
        let extraDict = dic[(appDominantText.replacingOccurrences(of: "province", with: "xt"))] as? [String: Any]
        //: let msgInfoDict = extraDict?["msgInfo"] as? [String: Any]
        let msgInfoDict = extraDict?[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] as? [String: Any]
        //: let user = dic["user"] as? [String: Any] ?? [:]
        let user = dic[(appDevilStr.replacingOccurrences(of: "quantity", with: "r"))] as? [String: Any] ?? [:]

        //: guard let model = try? AbTalkingChatMsgBaseModel(dictionary: extraDict) else {
        guard let model = try? SpotModel(dictionary: extraDict) else {
            //: return nil
            return nil
        }
        //: var isSelf = (model.user.uid == CompositionReactiveCompatible.share.loginUserMode.userID.intValue)
        var isSelf = (model.user.uid == CompositionReactiveCompatible.share.loginUserMode.userID.intValue)

        // 后台代发送的自动打招呼消息
        //: var isAutoSendMsg = false
        var isAutoSendMsg = false
        //: if model.msgInfo.uid.intValue == CompositionReactiveCompatible.share.loginUserMode.userID.intValue &&
        if model.msgInfo.uid.intValue == CompositionReactiveCompatible.share.loginUserMode.userID.intValue &&
            //: model.msgInfo.messageType.rawValue == 3 {
            model.msgInfo.messageType.rawValue == 3
        {
            //: isSelf = true
            isSelf = true
            //: isAutoSendMsg = true
            isAutoSendMsg = true
        }

        //: if dic["rYMsgType"] as? String == "GJ:Sess:AutoGreet:TxtCustom" {
        if dic[(String(dataThemeId.suffix(4)) + String(constPlusStr))] as? String == (String(const_processingKey.prefix(7)) + notiComputerName.capitalized + String(showFlagExecuteMessage)) {
            //: isSelf = msgInfoDict?["changeDirection"] as? Bool ?? false
            isSelf = msgInfoDict?[(String(show_appropriateTitle) + String(main_editorMessage.suffix(6)) + "irec" + data_windowFormat.replacingOccurrences(of: "combined", with: "n"))] as? Bool ?? false
        }

        //: let contentType = messageCellType(dic)
        let contentType = lockout(dic)

        // 系统消息
        //: if extraDict?["msgType"] as? String == "system" ||
        if extraDict?[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(appMaxName)) ||
            //: contentType == .TXMessageContentType_tips {
            contentType == .TXMessageContentType_tips
        {
            //: let model = AbTalkingChatMsgBaseModel()
            let model = SpotModel()
            //: let tipModel = try? AbTalkingChatMsgTipsModel(dictionary: extraDict)
            let tipModel = try? StereoDogModel(dictionary: extraDict)
            //: cellData = TalkingChatTipsMsgCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = PreviouslyFactorCompartmentTipsInformationCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: if let content = dic["content"] as? String {
            if let content = dic[(String(mainFirstText) + k_absInformSpherePath.replacingOccurrences(of: "successful", with: "t"))] as? String {
                //: tipModel?.content = content
                tipModel?.content = content
            }
            //: if tipModel != nil {
            if tipModel != nil {
                //: model.tips = tipModel!
                model.tips = tipModel!
            }
            //: cellData?.msgModel = model
            cellData?.msgModel = model
            //: return cellData
            return cellData
        }

        // 其他消息类型的创建...
        //: switch contentType {
        switch contentType {
        //: case .TXMessageContentType_picture:
        case .TXMessageContentType_picture:
            //: cellData = MilitaryCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = MilitaryCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)

        //: case .TXMessageContentType_video:
        case .TXMessageContentType_video:
            //: cellData = MovieReactiveCompatible(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = MovieReactiveCompatible(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)

        //: case .TXMessageContentType_gift:
        case .TXMessageContentType_gift:
            //: if let groupID = tempModel.groupID, !groupID.isEmpty {
            if let groupID = tempModel.groupID, !groupID.isEmpty { // 群聊gift
                //: cellData = TalkingGroupChatGiftMsgCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                cellData = MaximumThen(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                //: } else {
            } else { // 私聊gift
                //: cellData = OpenceMoreCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                cellData = OpenceMoreCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            }

        //: case .TXMessageContentType_askforGift:
        case .TXMessageContentType_askforGift: // 索要礼物
            //: let tempDic = parseTXMessageData(data: cusData)
            let tempDic = collectionDoingData(data: cusData)
            //: if let extraData = tempDic["extra"] as? [String: Any],
            if let extraData = tempDic[(appDominantText.replacingOccurrences(of: "province", with: "xt"))] as? [String: Any],
               //: let msgInfoData = extraData["msgInfo"] as? [String: Any],
               let msgInfoData = extraData[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] as? [String: Any],
               //: !msgInfoData.isEmpty {
               !msgInfoData.isEmpty
            {
                //: if let info = try? AbTalkingChatMsgInfoModel(dictionary: msgInfoData) {
                if let info = try? AboutModel(dictionary: msgInfoData) {
                    //: model.msgInfo = info
                    model.msgInfo = info
                }
            }
            //: cellData = FactorSelectedCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = FactorSelectedCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: cellData?.msgModel = model
            cellData?.msgModel = model

        //: case .TXMessageContentType_voice:
        case .TXMessageContentType_voice:
            //: cellData = MidReactiveCompatible(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = MidReactiveCompatible(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            //: if let audioCellData = cellData as? MidReactiveCompatible {
            if let audioCellData = cellData as? MidReactiveCompatible {
                //: if audioCellData.voiceModel.db_voiceCacheWrap.msgId.isEmpty {
                if audioCellData.voiceModel.db_voiceCacheWrap.msgId.isEmpty {
                    //: let mainKey = checkPrimaryKey(withMsgModel: tempModel)
                    let mainKey = popModel(withMsgModel: tempModel)
                    //: var cacheWrap = WCDBVoiceMsgTable.db_getVoiceMsg(with: mainKey)
                    var cacheWrap = HelpReaderReactiveCompatible.aboveServer(with: mainKey)
                    //: if cacheWrap == nil {
                    if cacheWrap == nil {
                        //: cacheWrap = WCDBVoiceMsgTable.db_inserVoiceMsgToDB(packageDict(withTXMessage: tempModel))
                        cacheWrap = HelpReaderReactiveCompatible.burn(totalSince(withTXMessage: tempModel))
                        //: audioCellData.voiceModel.db_voiceCacheWrap = cacheWrap!
                        audioCellData.voiceModel.db_voiceCacheWrap = cacheWrap!
                        //: } else {
                    } else {
                        //: audioCellData.voiceModel.db_voiceCacheWrap = cacheWrap!
                        audioCellData.voiceModel.db_voiceCacheWrap = cacheWrap!
                    }
                }
            }

        //: case .TXMessageContentType_local:
        case .TXMessageContentType_local:
            //: cellData = TalkingChatMatchMsgCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            cellData = LettuceThen(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)

        //: default:
        default:
            //: let title = extraDict?["title"] as? String ?? ""
            let title = extraDict?[(app_leadingId.replacingOccurrences(of: "require", with: "it"))] as? String ?? ""
            //: let content = extraDict?["content"] as? String ?? ""
            let content = extraDict?[(String(mainFirstText) + k_absInformSpherePath.replacingOccurrences(of: "successful", with: "t"))] as? String ?? ""
            //: let img = extraDict?["img"] as? String ?? ""
            let img = extraDict?[(String(dataFirstKey))] as? String ?? ""
            //: if !title.isEmpty || !content.isEmpty || !img.isEmpty {
            if !title.isEmpty || !content.isEmpty || !img.isEmpty { // 系统新消息
                //: cellData = TalkingChatSystemNotifJumpMsgCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                cellData = ListenCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                //: cellData?.extraDict = extraDict
                cellData?.extraDict = extraDict
                //: } else if let groupID = tempModel.groupID, !groupID.isEmpty {
            } else if let groupID = tempModel.groupID, !groupID.isEmpty { // 群聊text
                //: cellData = BrowseThen(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                cellData = BrowseThen(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                //: } else {
            } else { // 私聊text
                //: cellData = SortCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
                cellData = SortCellData(direction: isSelf ? .MsgDirectionOutgoing : .MsgDirectionIncoming)
            }
        }

        // 设置用户信息
        //: if model.user.nickname.isEmpty {
        if model.user.nickname.isEmpty {
            //: var userDict = user
            var userDict = user
            //: userDict.merge(msgInfoDict ?? [:]) { (_, new) in new }
            userDict.merge(msgInfoDict ?? [:]) { _, new in new }
            //: if let userModel = try? AbTalkingChatMsgUserModel(dictionary: userDict) {
            if let userModel = try? SaveModel(dictionary: userDict) {
                //: if userModel.uid == 0 {
                if userModel.uid == 0 {
                    //: userModel.uid = userDict["id"] as? Int ?? 0
                    userModel.uid = userDict["id"] as? Int ?? 0
                }
                //: if userModel.headPic.isEmpty == true {
                if userModel.headPic.isEmpty == true {
                    //: userModel.headPic = userDict["icon"] as? String ?? ""
                    userModel.headPic = userDict[(appClipAirHeartStr.replacingOccurrences(of: "incident", with: "co"))] as? String ?? ""
                }

                //: if isAutoSendMsg {
                if isAutoSendMsg {
                    //: userModel.uid = model.msgInfo.toUid.intValue
                    userModel.uid = model.msgInfo.toUid.intValue
                    //: userModel.headPic =
                    userModel.headPic =
                        //: CompositionReactiveCompatible.share.loginUserMode.headPic ?? ""
                        CompositionReactiveCompatible.share.loginUserMode.headPic ?? ""
                }
                //: model.user = userModel
                model.user = userModel
            }
        }

        //: if model.msgInfo == nil {
        if model.msgInfo == nil {
            //: let msgInfoModel = AbTalkingChatMsgInfoModel()
            let msgInfoModel = AboutModel()
            //: msgInfoModel.content = dic["content"] as? String ?? ""
            msgInfoModel.content = dic[(String(mainFirstText) + k_absInformSpherePath.replacingOccurrences(of: "successful", with: "t"))] as? String ?? ""
            //: msgInfoModel.jumps = extraDict?["extra"] as? [Any] ?? []
            msgInfoModel.jumps = extraDict?[(appDominantText.replacingOccurrences(of: "province", with: "xt"))] as? [Any] ?? []
            //: model.msgInfo = msgInfoModel
            model.msgInfo = msgInfoModel
        }

        // 聊天室送礼消息
        //: if contentType == .TXMessageContentType_gift && tempModel.groupID != nil && !tempModel.groupID!.isEmpty {
        if contentType == .TXMessageContentType_gift && tempModel.groupID != nil && !tempModel.groupID!.isEmpty {
            //: if model.toUser.uid.isEmpty {
            if model.toUser.uid.isEmpty { // 送礼所有人
                //: let toUserInfo = AbTalkingChatMsgToUserModel()
                let toUserInfo = WakelessModel()
                //: toUserInfo.uid = "all"
                toUserInfo.uid = (String(noti_halfId))
                //: toUserInfo.nickname = model.gift.sendNum
                toUserInfo.nickname = model.gift.sendNum
                //: toUserInfo.headPic = "icon_chats_pcr"
                toUserInfo.headPic = (String(data_fastUrl))
                //: model.toUser = toUserInfo
                model.toUser = toUserInfo
            }
        }
        //: cellData?.msgModel = model
        cellData?.msgModel = model

        // 本地自定义字段处理
        //: let customStr = String(data: cusData, encoding: .utf8) ?? ""
        let customStr = String(data: cusData, encoding: .utf8) ?? ""
        //: let customDic = NSDictionary.dictionary(withJsonString: customStr) ?? [:]
        let customDic = NSDictionary.progressModelOffer(withJsonString: customStr) ?? [:]
        //: let statusStr = customDic["status"] as? String ?? "0"
        let statusStr = customDic[(mainSubjectEffText.replacingOccurrences(of: "part", with: "t"))] as? String ?? "0"
        //: let status = TMsgStatus(rawValue: UInt(statusStr) ?? 0) ?? .Msg_Status_Init
        let status = TMsgStatus(rawValue: UInt(statusStr) ?? 0) ?? .Msg_Status_Init
        //: cellData?.status = status
        cellData?.status = status
        //: cellData?.msgIncome = CGFloat(customDic["msgIncome"] as? Float ?? 0)
        cellData?.msgIncome = CGFloat(customDic[(String(noti_layerMessage))] as? Float ?? 0)
        //: cellData?.messageType = msgInfoDict?["messageType"] as? Int ?? 0
        cellData?.messageType = msgInfoDict?[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int ?? 0

        //: if let msgId = customDic["msgId"] as? String {
        if let msgId = customDic[(String(show_speakerPath.prefix(5)))] as? String {
            //: cellData?.msgModel.msgInfo.msgId = msgId
            cellData?.msgModel.msgInfo.msgId = msgId
        }

        // 文本翻译
        //: if let translateStatus = customDic["TMsgTranslateStatus"] as? Int {
        if let translateStatus = customDic[(String(showScoreValue) + data_coordinatorUrl.lowercased())] as? Int {
            //: cellData?.translateStatus = TMsgTranslateStatus(rawValue: UInt(translateStatus)) ?? .MsgTranslate_init
            cellData?.translateStatus = ProposalColumnConvertible(rawValue: UInt(translateStatus)) ?? .MsgTranslate_init
        }
        //: if let translatedContent = customDic["TMsgTranslatedContent"] as? String {
        if let translatedContent = customDic[(String(user_capableMinProvideName) + userSlimStr.replacingOccurrences(of: "somebody", with: "nt"))] as? String {
            //: cellData?.translatedContent = translatedContent
            cellData?.translatedContent = translatedContent
        }

        // 私密照片Cache
        //: if contentType == .TXMessageContentType_picture {
        if contentType == .TXMessageContentType_picture {
            //: let dict = AbTalkingChatMsgIntimatePhotoModel.loadLocalIntimatePhotoDict()
            let dict = OnerModel.draw()
            //: if let photoData = dict[tempModel.msgID as Any] as? String {
            if let photoData = dict[tempModel.msgID as Any] as? String {
                //: cellData?.msgModel.msgInfo.intimatePhoto = AbTalkingChatMsgIntimatePhotoModel(string: photoData, error: nil)
                cellData?.msgModel.msgInfo.intimatePhoto = OnerModel(string: photoData, error: nil)
            }
        }

        // 私密视频Cache
        //: if contentType == .TXMessageContentType_video {
        if contentType == .TXMessageContentType_video {
            //: let dict = AbTalkingChatMsgVideoModel.loadLocalIntimateVideoDict()
            let dict = SubmitModel.suite()
            //: if let videoData = dict[tempModel.msgID as Any] as? String {
            if let videoData = dict[tempModel.msgID as Any] as? String {
                //: cellData?.msgModel.msgInfo.video = AbTalkingChatMsgVideoModel(string: videoData, error: nil)
                cellData?.msgModel.msgInfo.video = SubmitModel(string: videoData, error: nil)
            }
        }

        // 索要礼物Cache
        //: if contentType == .TXMessageContentType_askforGift {
        if contentType == .TXMessageContentType_askforGift {
            //: let arr = WantGiftModel.loadAskForGiftArr()
            let arr = ScopeModel.withoutAcross()
            //: if arr.contains(tempModel.msgID as Any) {
            if arr.contains(tempModel.msgID as Any) { // 已发送
                //: cellData?.msgModel.msgInfo.wantGift.sendStatus = 1
                cellData?.msgModel.msgInfo.wantGift.sendStatus = 1
            }
        }

        //: return cellData
        return cellData
    }

    // MARK: - 辅助方法

    /// 根据字典获取消息类型
    //: public class func messageCellType(_ extraDic: [String: Any]) -> TXMessageContentType {
    public class func lockout(_ extraDic: [String: Any]) -> SortEquatable {
        //: let dic = extraDic["extra"] as? [String: Any]
        let dic = extraDic[(appDominantText.replacingOccurrences(of: "province", with: "xt"))] as? [String: Any]
        //: let msgInfo = dic?["msgInfo"] as? [String: Any]
        let msgInfo = dic?[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] as? [String: Any]
        //: guard let model = try? AbTalkingChatMsgBaseModel(dictionary: dic) else {
        guard let model = try? SpotModel(dictionary: dic) else {
            //: return .TXMessageContentType_text
            return .TXMessageContentType_text
        }

        // 系统消息 官方小密
        //: if dic?["formatType"] as? String == "plain" {
        if dic?[(main_smallMessage.replacingOccurrences(of: "preserve", with: "ma") + "tTyp" + String(constAutomaticText))] as? String == (app_truthId.replacingOccurrences(of: "narrow", with: "p")) {
            //: let imageUri = dic?["imageUri"] as? String ?? ""
            let imageUri = dic?[(String(main_stemId) + String(user_topicKey))] as? String ?? ""
            //: let imageData = dic?["imageData"] as? String ?? ""
            let imageData = dic?[(showSoundPastPath.replacingOccurrences(of: "ear", with: "a") + "Data")] as? String ?? ""
            //: let isImageStyle = !imageData.isEmpty || !imageUri.isEmpty
            let isImageStyle = !imageData.isEmpty || !imageUri.isEmpty
            //: if isImageStyle {
            if isImageStyle {
                //: return .TXMessageContentType_picture
                return .TXMessageContentType_picture
            }
        }

        // 图片||私密照片
        //: if !model.msgInfo.imageUri.isEmpty || !model.msgInfo.imageData.isEmpty || !model.msgInfo.intimatePhoto.originUrl.isEmpty {
        if !model.msgInfo.imageUri.isEmpty || !model.msgInfo.imageData.isEmpty || !model.msgInfo.intimatePhoto.originUrl.isEmpty {
            //: return .TXMessageContentType_picture
            return .TXMessageContentType_picture
        }

        // 接收的视频消息 || 本人发送的视频消息
        //: if !model.msgInfo.video.videoUrl.isEmpty || model.msgInfo.contentType == "VideoMsg" {
        if !model.msgInfo.video.videoUrl.isEmpty || model.msgInfo.contentType == (kDiscoverMsg.replacingOccurrences(of: "spread", with: "V") + String(appFailureUrl)) {
            //: return .TXMessageContentType_video
            return .TXMessageContentType_video
        }

        // 礼物，非打招呼消息
        //: if !model.gift.name.isEmpty && model.msgInfo.messageType.rawValue != 4 {
        if !model.gift.name.isEmpty && model.msgInfo.messageType.rawValue != 4 {
            //: return .TXMessageContentType_gift
            return .TXMessageContentType_gift
        }

        //: let isVoiceStyle = checkVoiceMsg(msginfo: msgInfo ?? [:])
        let isVoiceStyle = the(msginfo: msgInfo ?? [:])
        //: if isVoiceStyle {
        if isVoiceStyle {
            //: return .TXMessageContentType_voice
            return .TXMessageContentType_voice
        }

        //: if (dic?["match"] as? Int) == 1 || (msgInfo?["match"] as? Int) == 1 {
        if (dic?[(kMatchMessage.lowercased())] as? Int) == 1 || (msgInfo?[(kMatchMessage.lowercased())] as? Int) == 1 {
            // 匹配消息
            //: return .TXMessageContentType_local
            return .TXMessageContentType_local
        }

        //: if dic?["msgType"] as? String == "tips" || (dic?["messageType"] as? Int) == 17 {
        if dic?[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (app_sitStr.replacingOccurrences(of: "properly", with: "ip")) || (dic?[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int) == 17 {
            // 提示消息,包含超时未回复
            //: return .TXMessageContentType_tips
            return .TXMessageContentType_tips
        }

        //: if (dic?["formatType"] as? String == "mf") && ((dic?["messageType"] as? Int) == 15 || (dic?["messageType"] as? Int) == 16) {
        if (dic?[(main_smallMessage.replacingOccurrences(of: "preserve", with: "ma") + "tTyp" + String(constAutomaticText))] as? String == "mf") && ((dic?[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int) == 15 || (dic?[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int) == 16) {
            // 提示消息，打招呼提示送出神秘礼物,对方设置价格消息提示
            //: return .TXMessageContentType_tips
            return .TXMessageContentType_tips
        }

        //: if dic?["msgType"] as? String == "userIntro" {
        if dic?[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(data_drownName)) {
            //: return .TXMessageContentType_userCard
            return .TXMessageContentType_userCard
        }

        //: if msgInfo?["msgType"] as? String == "WantGift" || (msgInfo?["messageType"] as? Int) == 25 {
        if msgInfo?[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String == (String(k_unablePath) + noti_sizeText.replacingOccurrences(of: "frank", with: "f")) || (msgInfo?[(String(mainDemonstrateMessage) + String(showAudienceLengthEqualMsg.prefix(6)))] as? Int) == 25 {
            //: return .TXMessageContentType_askforGift
            return .TXMessageContentType_askforGift
        }

        //: return .TXMessageContentType_text
        return .TXMessageContentType_text
    }

    // MARK: - 语音消息处理

    /// 从TX的model里提取参数
    //: public class func packageDict(withTXMessage message: V2TIMMessage) -> [String: Any] {
    public class func totalSince(withTXMessage message: V2TIMMessage) -> [String: Any] {
        //: let extra = String(data: message.customElem.data, encoding: .utf8) ?? ""
        let extra = String(data: message.customElem.data, encoding: .utf8) ?? ""
        //: let dic = NSDictionary.dictionary(withJsonString: extra) ?? [:]
        let dic = NSDictionary.progressModelOffer(withJsonString: extra) ?? [:]
        //: let extraData = dic["extra"] as? [String: Any]
        let extraData = dic[(appDominantText.replacingOccurrences(of: "province", with: "xt"))] as? [String: Any]
        //: let msgInfo = extraData?["msgInfo"] as? [String: Any]
        let msgInfo = extraData?[(dataColumnId.replacingOccurrences(of: "come", with: "s") + String(constTitleureData))] as? [String: Any]
        //: let user = extraData?["user"] as? [String: Any]
        let user = extraData?[(appDevilStr.replacingOccurrences(of: "quantity", with: "r"))] as? [String: Any]

        //: let senderId = msgInfo?["senderId"] as? String ?? ""
        let senderId = msgInfo?[(String(showFormatMessage))] as? String ?? ""
        //: var info = msgInfo
        var info = msgInfo

        // 自己发送的和接收的数据结构不一样
        //: if senderId == CompositionReactiveCompatible.share.loginUserMode.userID {
        if senderId == CompositionReactiveCompatible.share.loginUserMode.userID {
            //: info?["senderId"] = senderId
            info?[(String(showFormatMessage))] = senderId
            //: info?["targetId"] = message.userID ?? (user?["targetId"] as? String ?? "")
            info?[(String(showUponText.suffix(7)) + user_sufficientFormat.replacingOccurrences(of: "dimension", with: "d"))] = message.userID ?? (user?[(String(showUponText.suffix(7)) + user_sufficientFormat.replacingOccurrences(of: "dimension", with: "d"))] as? String ?? "")
            //: } else {
        } else {
            //: info?["senderId"] = "\(msgInfo?["uid"] as? Int ?? 0)"
            info?[(String(showFormatMessage))] = "\(msgInfo?[(const_animaId.replacingOccurrences(of: "weather", with: "i"))] as? Int ?? 0)"
            //: info?["targetId"] = "\(msgInfo?["uid"] as? Int ?? 0)"
            info?[(String(showUponText.suffix(7)) + user_sufficientFormat.replacingOccurrences(of: "dimension", with: "d"))] = "\(msgInfo?[(const_animaId.replacingOccurrences(of: "weather", with: "i"))] as? Int ?? 0)"
        }

        //: if msgInfo?.keys.contains("msgId") ?? false {
        if msgInfo?.keys.contains((String(show_speakerPath.prefix(5)))) ?? false {
            //: info?["msgId"] = "\(msgInfo?["msgId"] ?? "")"
            info?[(String(show_speakerPath.prefix(5)))] = "\(msgInfo?[(String(show_speakerPath.prefix(5)))] ?? "")"
            //: } else {
        } else {
            //: let customStr = String(data: message.localCustomData, encoding: .utf8) ?? ""
            let customStr = String(data: message.localCustomData, encoding: .utf8) ?? ""
            //: let customDic = NSDictionary.dictionary(withJsonString: customStr) ?? [:]
            let customDic = NSDictionary.progressModelOffer(withJsonString: customStr) ?? [:]
            //: if customDic["msgId"] != nil {
            if customDic[(String(show_speakerPath.prefix(5)))] != nil {
                //: info?["msgId"] = "\(customDic["msgId"] ?? "")"
                info?[(String(show_speakerPath.prefix(5)))] = "\(customDic[(String(show_speakerPath.prefix(5)))] ?? "")"
                //: } else {
            } else {
                //: let txMsgId = !message.msgID.isEmpty ? message.msgID : "\(Int64(Date().timeIntervalSince1970))"
                let txMsgId = !message.msgID.isEmpty ? message.msgID : "\(Int64(Date().timeIntervalSince1970))"
                //: info?["msgId"] = txMsgId
                info?[(String(show_speakerPath.prefix(5)))] = txMsgId
            }
        }

        //: if msgInfo?.keys.contains("audioSandbox") ?? false {
        if msgInfo?.keys.contains((String(notiHockeyTitle.suffix(6)) + "andbox")) ?? false {
            //: info?["audioSandbox"] = "\(msgInfo?["audioSandbox"] ?? "")"
            info?[(String(notiHockeyTitle.suffix(6)) + "andbox")] = "\(msgInfo?[(String(notiHockeyTitle.suffix(6)) + "andbox")] ?? "")"
        }
        //: if msgInfo?.keys.contains("audioLength") ?? false {
        if msgInfo?.keys.contains((String(constSmallData) + String(app_thenText))) ?? false {
            //: info?["audioLength"] = "\(msgInfo?["audioLength"] ?? "")"
            info?[(String(constSmallData) + String(app_thenText))] = "\(msgInfo?[(String(constSmallData) + String(app_thenText))] ?? "")"
        }

        //: let formatter = DateFormatter()
        let formatter = DateFormatter()
        //: formatter.dateFormat = "yyyy-MM-dd HH:mm:ss"
        formatter.dateFormat = (String(main_giftName.prefix(6)) + "M-dd " + String(user_captureValue.suffix(7)) + appBottomText.replacingOccurrences(of: "square", with: "s"))
        //: info?["sendTime"] = formatter.string(from: message.timestamp ?? Date())
        info?[(String(notiDisappearPath))] = formatter.string(from: message.timestamp ?? Date())
        //: info?["isRead"] = senderId == CompositionReactiveCompatible.share.loginUserMode.userID ? "1" : "0"
        info?[(mainLibraryCapPath.lowercased() + String(k_platformData.suffix(5)))] = senderId == CompositionReactiveCompatible.share.loginUserMode.userID ? "1" : "0"

        //: return info ?? [:]
        return info ?? [:]
    }

    //: public class func checkPrimaryKey(withMsgModel tempModel: V2TIMMessage) -> String {
    public class func popModel(withMsgModel tempModel: V2TIMMessage) -> String {
        //: let v2Info = packageDict(withTXMessage: tempModel)
        let v2Info = totalSince(withTXMessage: tempModel)
        //: let key = "\(v2Info["msgId"] ?? "")"
        let key = "\(v2Info[(String(show_speakerPath.prefix(5)))] ?? "")"
        //: print("key = \(key)")
        //: return key
        return key
    }

    // MARK: - JSON处理方法

    //: @objc public class func parseTXMessageData(data: Data) -> [String: Any] {
    @objc public class func collectionDoingData(data: Data) -> [String: Any] {
        //: do {
        do {
            //: let dict = try JSONSerialization.jsonObject(
            let dict = try JSONSerialization.jsonObject(
                //: with: data, options: .mutableContainers)
                with: data, options: .mutableContainers
            )
            //: return dict as? [String: Any] ?? [:]
            return dict as? [String: Any] ?? [:]
            //: } catch {
        } catch {
            //: return [:]
            return [:]
        }
    }

    //: @objc public class func parseTXMessageJsonStr(data: [String: Any]) -> String {
    @objc public class func yesterday(data: [String: Any]) -> String {
        //: do {
        do {
            //: let jsonData = try JSONSerialization.data(
            let jsonData = try JSONSerialization.data(
                //: withJSONObject: data, options: [])
                withJSONObject: data, options: []
            )
            //: return String(data: jsonData, encoding: .utf8) ?? ""
            return String(data: jsonData, encoding: .utf8) ?? ""
            //: } catch {
        } catch {
            //: return ""
            return ""
        }
    }

    // MARK: - 语音消息检测

    //: @objc public class func checkVoiceMsg(msginfo: [String: Any]) -> Bool {
    @objc public class func the(msginfo: [String: Any]) -> Bool {
        //: if let msgType = msginfo["msgType"] as? String, msgType == "audio" {
        if let msgType = msginfo[(String(constReasonGivenMsg.prefix(5)) + dataNorthFormat.replacingOccurrences(of: "error", with: "e"))] as? String, msgType == (constOccurTitle.lowercased()) {
            //: return true
            return true
        }
        //: if let contentType = msginfo["contentType"] as? String,
        if let contentType = msginfo[(String(app_descriptionUrl))] as? String,
           //: contentType == "AudioMsg"
           contentType == (String(appFatalData.suffix(7)) + app_requestId.replacingOccurrences(of: "living", with: "g"))
        {
            //: return true
            return true
        }
        //: if let audioData = msginfo["audioData"] as? String, !audioData.isEmpty {
        if let audioData = msginfo[(String(user_ceremonyPath))] as? String, !audioData.isEmpty {
            //: return true
            return true
        }
        //: if let audioUri = msginfo["audioUri"] as? String, !audioUri.isEmpty {
        if let audioUri = msginfo[(String(notiDecisionStr))] as? String, !audioUri.isEmpty {
            //: return true
            return true
        }
        //: return false
        return false
    }
}
